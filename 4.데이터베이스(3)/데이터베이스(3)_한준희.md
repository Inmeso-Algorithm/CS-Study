# 데이터베이스(3)

## 목차

### 4.4 데이터베이스의 종류

- 4.4.1 관계형 데이터베이스
- 4.4.2 NoSQL 데이터베이스

### 4.5 인덱스

- 4.5.1 인덱스의 필요성
- 4.5.2 B-트리
- 4.5.3 인덱스 만드는 방법
- 4.5.4 인덱스 최적화 기법

### 4.6 조인의 종류

- 4.6.1 내부 조인
- 4.6.2 왼쪽 조인
- 4.6.3 오른쪽 조인
- 4.6.4 합집합 조인

### 4.7 조인의 원리

- 4.7.1 중첩 루프 조인
- 4.7.2 정렬 병합 조인
- 4.7.3 해시 조인

---

# 4.4 데이터베이스의 종류

## 4.4.1 관계형 데이터베이스

관계형 데이터베이스는 행과 열을 가지는 표 형식 데이터를 저장하는 형태의 데이터베이스를 가리키며 SQL이라는 언어를 써서 조작한다. 표준 SQL을 지키기는 하지만, 각각의 제품에 특화시킨 SQL을 사용한다.

대표적인 두가지

[스택 오버플로우 링크](https://insights.stackoverflow.com/survey/2021/#most-popular-technologies-database)

1. MySQL
   대부분의 운영체제와 호환되며 현재 가장 많이 사용하는 데이터베이스이다.
   C,C++로 만들어져있고, B-트리 기반의 인덱스, 매우 빠른 조인을 재공한다. 대용량 데이터베이스를 위해 설계되어있고 롤백, 커밋, 이중암호지원보안 등의 기능을 제공하며 많은 서비스에서 사용한다.
2. PostgreSQL
   최대 테이블의 크기는 32TB이며 SQL뿐만 아니라 JSON을 이용해서 데이터에 접근할 수 있다.
   지정 시간에 복구하는 기능, 로깅, 접근 제어, 중첩된 트랜잭션, 백업 등을 할 수 있다.

## 4.4.2 NoSQL 데이터베이스

Not only SQL 이라는 슬로건에서 생겨난 데이터베이스이다. SQL을 사용하지 않는 데이터베이스를 말하고, 대표적으로 MongoDB와 redis가 있다.

1. MongoDB

JSON을 통해 데이터에 접근할 수 있고, Binary JSON 형태(BSON)로 데이터가 저장되며 와이어드타이거 엔진이 기본 스토리지 엔진으로 장착된 키-값 데이터 모델에서 확장된 도큐먼트 기반의 데이터베이스이다.

도큐먼트를 생성할 때마다 다른 컬렉션에서 중복된 값을 지니기 힘든 유니크한 값인 ObjectID가 생성된다. 이는 기본키로 유닉스 시간 기반의 타임스탬프(4바이트), 랜덤 값(5바이트), 카운터(3바이트)로 이루어져있다.

2. redis

인메모리 데이터베이스이자 키-값 데이터 모델 기반의 데이터베이스이다. 기본적인 데이터 타입은 문자열이고 최대 512MB까지 저장할 수 있다. set, hash 등도 지원한다.

# 4.5 인덱스

## 4.5.1 인덱스의 필요성

인덱스는 데이터를 빠르게 찾을 수 있는 하나의 장치이다. 인덱스를 설정하면 테이블 안에 찾고자 하는 데이터를 빠르게 찾을 수 있다.

## 4.5.2 B-트리

B-트리는 루트 노드, 리프 노드, 그리고 그 사이의 브랜치 노드로 나뉜다.

### 인덱스가 효율적인 이유와 대수확장성

인덱스가 효율적인 이유 : 효율적인 단계를 거쳐 모든 요소에 접근할 수 있는 균형잡힌 트리 구조와 트리 깊이의 대수확장성 때문이다.

**대수확장성** : 트리 깊이가 리프 노드 수에 비해 매우 느리게 성장하는 것을 의미한다. 로그함수와 비슷

## 4.5.3 인덱스 만드는 방법

## 4.5.4 인덱스 최적화 기법

1. 인덱스는 비용이다.
   인덱스도 결국에는 비용이 들기 때문ㅇ에 쿼리에 있는 필드에 인덱스를 다 설정하는 것은 답이 아니다. 컬렉션에서 가져와야 하는 양이 많을수록 인덱스를 사용하는 것은 비효율적이다.
2. 항상 테스팅을 해보면서 걸리는 시간을 최소화해야한다.
3. 복합 인덱스는 같은, 정렬, 다중 값, 카디널리티 순이다.

   인덱스를 생성하는 순서에 따라 인덱스 성능이 달라진다.
   같음, 정렬, 다중 값, 카디널리티 순으로 생성해야 한다.

# 4.6 조인의 종류

조인(join)이란 하나의 테이블이 아닌 두 개 이상의 테이블을 묶어서 하나의 결과물을 만드는 것을 말한다.

왼쪽 테이블을 A, 오른쪽 테이블을 B라고 가정한다.

- 내부 조인(inner join) : 왼쪽 테이블과 오늘쪽 테이블의 두 행이 모두 일치하는 행이 있는 부분만 표기한다.
- 왼쪽 조인(left outer join) : 왼쪽 테이블의 모든 행이 결과 테이블에 표기된다.
- 오른쪽 조인(righr outer join) : 오른쪽 테이블의 모든 행이 결과 테이블에 표기된다.
- 합집합 조인(full outer join) : 두 개의 테이블ㅇ르 기반으로 조인 조건에 만족하지 않는 행까지 모두 표기한다.

## 4.6.1 내부 조인

두 테이블 간의 교집합을 나타낸다.

## 4.6.2 왼쪽 조인

테이블 B의 A와 겹치는 부분과 함께 A를 기준으로 완전한 레코드 집합을 생성한다.
만약 B에 일치하는 항목이 없으면 해당 값은 null 값이 된다.

## 4.6.3 오른쪽 조인

테이블 A의 B와 겹치는 부분과 함께 B를 기준으로 완전한 레코드 집합을 생성한다.
만약 A에 일치하는 항목이 없으면 해당 값은 null 값이 된다.

## 4.6.4 합집합 조인

완전 외부 조인이라고도 한다.

양쪽 테이블에서 일치하는 레코드와 함께 테이블 A와 테이블 B의 모든 레코드 집합을 생성한다.

# 4.7 조인의 원리

## 4.7.1 중첩 루프 조인

중첩 for문과 같은 원리로 조건에 맞는 조인을 하는 방법이며, 랜덤 접근에 대한 비용이 많이 증가하므로 대용량의 테이블에서는 사용하지 않는다.

## 4.7.2 정렬 병합 조인

각각의 테이블을 조인할 필드 기준으로 정렬하고 정렬이 끝난 이후에 조인 작업을 수행하는 조인이다.

조인할 때 쓸 적절한 인덱스가 없고 대용량의 테이블들을 조인하고 조인 조건으로 범위 비교 연산자가 있을 때 쓴다.

## 4.7.3 해시 조인

해시 테이블을 기반으로 조인하는 방법이다. 두 테이블중 작은 테이블을 기반으로 조인에 사용되는 필드가 해시 테이블의 키로 사용된다. 그 후 해시 테이블을 기반으로 일치하는 레코드를 인메모리 해시 테이블에서 찾을 수 있다.
