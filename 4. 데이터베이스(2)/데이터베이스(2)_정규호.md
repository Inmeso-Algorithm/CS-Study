# 4. 데이터베이스

## 목차

2. ERD와 정규화 과정
3. 트랜잭션과 무결성

## 2. ERD와 정규화 과정

### 1. ERD

Entity-Relation Diagram의 약자로, DB를 설계할 때 가장 기본적인 테이블 (relation) 간 관계를 정의하는 다이어그램입니다.

- 관계형 DB를 표시하기에 매우 유리
- 비정형 DB (NoSQL)에는 적합하지 않다.

### 2. 정규화 (Normalisation)

정의: 릴레이션 간의 종속 관계를 바로잡아 중복 데이터를 제거하고, 데이터 정합성 (integrity)을 만족하도록 릴레이션을 여러 개로 나누는 과정을 뜻합니다.  
예를 들어, 회원 정보 테이블도 사용자 닉네임을 가지고 있고, 게시글 테이블, 댓글 테이블도 각자 사용자 닉네임을 가지고 있는데, 사용자 닉네임이 변경된다면? 정규화가 제대로 되어 있지 않은 상태에서는 모든 테이블에 기록된 닉네임을 하나하나 수정해야 합니다.

정규형의 원칙이란,

- 같은 의미를 표현하는 릴레이션이지민 좀 더 좋은 구조로 만들어야 하고,
- 자료의 중복성이 감소해야 하고,
- 독립적인 관계는 별개의 릴레이션으로 표현이 가능해야 합니다.

정규형에는 제1정규형, 제2정규형, 제3정규형, BCNF, 제4정규형, 제5정규형이 존재합니다.

### 3. 제1정규형

정의: 모든 도메인이 더 이상 분해될 수 없는 원자값 (atomic)으로만 구성되어 있는 상태를 제1정규형이라고 합니다.

| commentId | userName | comment           |
| --------- | -------- | ----------------- |
| 1         | planPt   | {아 ㅋㅋ}, {링컨} |

위와 같은 테이블은 제1정규화 진행이 되어 있지 않습니다. comment라는 속성에 값이 2개 이상 존재하는 경우가 존재합니다.  
아래와 같이 제1정규화를 진행할 수 있습니다.

| commentId | userName | comment |
| --------- | -------- | ------- |
| 1         | planPt   | 아 ㅋㅋ |
| 2         | planPt   | 링컨    |

### 4. 제2정규형

## 3. 트랜잭션과 무결성

정의: 제1정규형을 만족하며, 부분 함수의 종속성을 제거한 형태를 제2정규형이라고 합니다.

| postId | creatorId  | contents              | commentId | commentViews |
| ------ | ---------- | --------------------- | --------- | ------------ |
| 1      | KAKAO00001 | 안녕                  | 1         | 23           |
| 2      | GOOGL00001 | 등업좀요              | 2         | 21           |
| 3      | KAKAO00002 | 히어로즈 오브 더 스톰 | 3         | 37           |
| 4      | NAVER00001 | 네카라쿠배            | 4         | 132          |

위와 같은 릴레이션이 존재할 때, PK는 postId입니다.  
각 글은 하나의 작성자, 하나의 내용, 여러 개의 댓글을 가집니다. 한 댓글은 하나의 조회수를 가집니다.  
creatorId, contents는 postId에 의존하지만, commentViews는 commentId에 의존합니다. 따라서 위의 릴레이션은 부분 함수의 종속성이 존재하므로, 제2정규형을 만족하지 못합니다.  
제2정규화를 통해 아래와 같이 분리할 수 있습니다.

| postId | creatorId  | contents              |
| ------ | ---------- | --------------------- |
| 1      | KAKAO00001 | 안녕                  |
| 2      | GOOGL00001 | 등업좀요              |
| 3      | KAKAO00002 | 히어로즈 오브 더 스톰 |
| 4      | NAVER00001 | 네카라쿠배            |

| commentId | postId | commentViews |
| --------- | ------ | ------------ |
| 1         | 1      | 23           |
| 2         | 2      | 21           |
| 3         | 3      | 37           |
| 4         | 4      | 132          |

### 5. 제3정규형

정의: 제2정규형을 만족하며, 이행적 함수 종속을 제거하면 제3정규형이 됩니다.  
이행적 함수 종속이란, A->B이고 B->C일 때, A->C가 성립하는데, 이때 'C가 A에 이행적 함수 종속이다'라고 합니다.

### 6. BCNF (Boyce-Code Normal Form)

정의: 제3정규형이며, 결정자가 후보키가 아닌 함수 종속 관계를 제거하여, 릴레이션 내의 함수 종속 관계에서 모든 결정자가 후보키인 상태를 말합니다.

### 7. 정규형의 장점과 단점

정규형의 단계까 올라갈수록 중복 데이터가 제거되고, 데이터 정합성이 잘 지켜지게 됩니다. 사용자 정보를 담은 릴레이션 안에서만 이름, 이메일, 주소 등의 정보를 관리하고 다른 릴레이션에서는 사용자 고유 ID를 통해 조회한다면, 여기저기서 데이터를 다 입력하고 수정할 필요가 없지요.  
하지만 정규형의 단계가 올라갈수록 더 많은 테이블로 나누기 때문에, 단점도 발생합니다. 릴레이션 간 join 연산을 반복하며 성능 상에서 크게 손해를 볼 수도 있고, 릴레이션 간의 관계를 잘 설계해야 하므로 구조 파악이 어려워질 수 있습니다. 따라서 보통 제4, 제5정규형은 잘 사용되지 않습니다.

## 3. 트랜잭션과 무결성

### 트랜잭션의 정의

### 원자성 (Atomicity)

### 지속성 (Consistency)

### 격리성 (Isolation)

### 지속성 (Durability)

### 트랜잭션의 격리 4단계 정의

### Read Uncommitted

### Read Committed

### Repeatable Read

### Serializable
