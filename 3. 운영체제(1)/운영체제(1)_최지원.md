# 3. 운영체제
운영체제(OS, Operating System)는 사용자가 컴퓨터를 쉽게 다루게 해주는 인터페이스라고 합니다. 컴퓨터의 전반적인 시스템 상에서의 운영체제의 역할을 그게 두가지로 나누어 볼 수 있습니다.   
1. 컴퓨터의 하드웨어들을 관리
2. 응용 프로그램들의 실행을 관리

이러한 두 가지 관점에서 운영체제가 어떤 방식으로 자신의 역할을 수행하는지 살펴볼 것입니다.   

*운영체제와 커널(Kernel)*   
- 커널은 운영체제안에 속해있는 구성요소 중 하나로 주로 메모리 관리나 디스크 I/O 관리 등 하드웨어 관리에 집중된 시스템 프로그램입니다.  
 
- 커널을 포함해 전반적인 컴퓨터 시스템을 담당하는 프로그램이 운영체제 입니다.

---

## 3.1 운영체제와 컴퓨터
### 3.1.1 운영체제의 역할과 구조
### 운영체제의 역할
운영체제의 역할은 다시 4가지로 세분화될 수 있습니다.
- CPU 스케줄링과 프로세스 관리
- 메모리 관리
- 디스크 파일 관리
- I/O 디바이스 관리

### 운영체제의 구조
![image](https://user-images.githubusercontent.com/103945439/187126936-f3853a7d-b7dd-461f-a3dd-8aac1dabc650.png)

운영체제는 많은 구성요소로 이루어져 있지만 기본적으로 유저 프로그램과 하드웨어 사이에 위치해 있습니다.

### 시스템콜
모든 컴퓨터의 하드웨어들은 운영체제가 관리합니다. 사용자 프로그램이 하드웨어를 사용하고자 할 때에도, 사용자 프로그램이 바로 접근 할 수 없고 운영체제를 거쳐서 사용하게 됩니다.

사용자 프로그램이 하드웨어에 접근하는 방법이 바로 시스템콜 입니다. 사용자 프로그램이 I/O 요청으로 트랩(trap)을 발동하면 운영체제는 이것이 올바른 요청인지 확인한 후 유저 모드가 커널 모드로 변환되어 실행됩니다.

*인터럽트(Interrupt)란?*   

인터럽트란 CPU가 작업을 처리하던 중 처리해야할 이벤트가 발생하여 CPU에 알려 처리하도록 하는 신호입니다. 처리해야 할 이벤트의 특성에 따라 하드웨어 인터럽트와 소프트웨어 인터럽트로 나뉩니다.

**하드웨어 인터럽트**   

통상적으로 우리가 인터럽트라고 부르는 것들은 하드웨어 인터럽트를 의미합니다. 하드웨어 인터럽트에는 다음과 같은 특징들이 있습니다.
- Asynchronous interrupt(비동기식 인터럽트)
- I/O device와 같은 하드웨어에서 발생

![image](https://user-images.githubusercontent.com/103945439/187339377-38c05d43-4877-4df0-b5cd-4e2adba70099.png)
하드웨어 인터럽트의 가장 대표적인 예시인 Keyboard**Interrupt** (ctrl^C)


**소프트웨어 인터럽트**   

소프트웨어로부터 발생하는 이벤트에 대한 인터럽트를 소프트웨어 인터럽트라고 합니다. 소프트웨어 인터럽트와 트랩은 CPU 제조사마다 정의에 있어 약간의 차이가 있지만 사실상 거의 같은 의미로 쓰입니다. 소프트웨어 인터럽트에는 다음과 같은 특징들이 있습니다.
- Synchronous interrupt(동기식 인터럽트)
- 소프트웨어로부터 발생
- 예외(Exception)와 시스템 콜 등이 대표적인 소프트웨어 인터럽트

![image](https://user-images.githubusercontent.com/103945439/187340125-a860a35f-839b-4562-8da1-49ef140b614d.png)
소프트웨어 인터럽트중 하나인 예외 (ZeroDivisionError)

### 유저 모드와 커널 모드
현 시대의 운영체제들은 dual-mode operation을 지원합니다. 이것은 유저 모드와 커널 모드를 나누어 두 모드간에 차이를 두는것을 의미하고, `modebit`를 이용해 구현되어집니다.

### modebit
modebit는 0또는 1의 값을 가지는 플래그 변수입니다. 운영체제는 시스템콜이 호출될 때 이 modebit를 참고하여 유저 모드와 커널 모드를 구분합니다.

![image](https://user-images.githubusercontent.com/103945439/187342405-7ce031d3-7eab-4673-81ba-97cd1ff6da5c.png)

사용자 프로그램이 하드웨어에 접근하고자 할 때는 반드시 시스템콜을 호출해 운영체제의 도움을 받아야합니다. 사용자 프로그램은 필요 시 시스템콜을 호출하고, 운영체제에서는 modebit를 0으로 바꿔 커널 모드에 진입했음을 의미하고 호출된 시스템콜을 실행합니다. 시스템콜 수행이 완료되고 반환 시 modebit는 다시 1로 바뀌어 유저모드로 돌아왔음을 의미하게 합니다.

운영체제가 수행하는 명령어에는 자칫 잘못 사용될 경우 치명적인 오류를 일으킬수 있는 명령어들도 존재합니다. 예를 들면 direct I/O access나 register 접근 등이 있습니다. 이러한 명령어들을 `Privileged instruction`이라고 합니다. 

Privileged instruction은 kernel mode 상태에서만 실행될 수 있습니다. User mode인 경우 실행되지 않습니다. 이렇게 함으로써 사용자 프로그램이 함부로 하드웨어에 접근하는것을 막을 수 있습니다.

---

### 3.1.2 컴퓨터의 요소
컴퓨터는 CPU, DMA 컨트롤러, 메모리, 타이머, 디바이스 컨트롤러 등으로 이루어져 있습니다.

#### CPU
CPU(Central Processing Unit)는 산술논리연산장치, 제어장치, 레지스터로 구성되어 있는 컴퓨터 장치를 말합니다.

#### 제어장치
제어장치(Control Unit)는 프로세스 조작을 지시하는 CPU의 한 부품입니다. 입출력장치 간 통신을 제어하고 명령어들을 읽고 해석하며 데이터 처리를 위한 순서를 결정합니다.

#### 레지스터
레지스터는 CPU 안에 있는 매우 빠른 임시기억장치를 가리킵니다. CPU와 직접 연결되어 있어 연산속도가 메모리보다 월등히 빠릅니다. CPU는 자체적으로 데이터를 저장할 수 없기 때문에 레지스터를 거쳐 데이터를 전달합니다.

#### 산술논리연산장치
산술논리연산장치(ALU, Arithmetic Logic Unit)는 산술 연산과 논리 연산을 계산하는 디지털 회로입니다.

#### DMA 컨트롤러
DMA 컨트롤러는 I/O 디바이스가 메모리에 직접 접근할 수 있도록 하는 하드웨어 장치를 뜻합니다. DMA가 I/O transfer를 전담하므로 그 동안 CPU에서는 다른 일을 처리할 수 있어 효율적입니다.

#### 메모리
메모리(Memory)는 전자회로에서 데이터나 상태, 명령어 등을 기록하는 장치를 말하면 보통 RAM(Random Access Memory)를 일컬어 메모리라고 합니다.