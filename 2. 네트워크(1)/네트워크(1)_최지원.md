# 2.1 네트워크의 기초
네트워크란 노드(Node)와 링크(Link)가 서로 연결되어 있거나 연결되어 있지 않은 집합체를 의미합니다. 여기서 노드는 서버, 라우터, 스위치 등의 장치를 의미하고 링크는 그것들이 유/무선으로 연결되어있음을 뜻합니다.
## 2.1.1 처리량과 지연 시간
좋은 네트워크를 구축하기 위해서는, 많은 처리량을 처리할수 있고 지연시간이 짧으면 보안성이 우수한 네트워크를 뜻합니다.
1. 처리량
- 처리량(Throughput)이란, 링크를 통해 전달되는 단위 시간당 데이터양을 말합니다.
2. 지연 시간
- 지연 시간(Latency)이란 요청이 처리되는 시간을 말하며 어떤 메시지가 두 장치 사이를 왕복하는 데 걸린 시간을 말합니다.
---
## 2.1.2 네트워크 토폴로지와 병목 현상
네트워크 토폴로지(Network topology)는 컴퓨터 네트워크의 구성요소들인 링크와 노드가 연결되어있는 방식 또는 연결 형태를 의미합니다. 여러 종류의 네트워크 토폴로지가 있고 이들마다의 장단점이 있습니다.
1. 트리 토폴로지
- 트리 토폴로지(Tree topology)는 계층형 토폴로지라고 하며 그래프 이론에서의 트리와 같은 형태로 배치한 네트워크 구성을 말합니다.
- 장점으로는 네트워크의 확장과 제거가 쉽고, 회선수가 절약된다는 점이 있습니다.
- 단점으로 상위 노드에 문제가 생겻을 때, 그 노드의 하위 노드들도 모두 영향을 받는다는 점이 있습니다.
2. 버스 토폴로지
- 버스 토폴로지(Bus topology)는 하나의 중앙 회선에 여러개의 노드들이 연결되어 있는 형태를 가진 네트워크 구성을 말합니다.
- 장점으로는 구축에 용이하고, 하나의 케이블에 연결하므로 설치 비용이 절감되며, 확장과 삭제에 유연하며, 트리 토폴로지와 달리 하나의 노드에 문제가 생겨도 다른 노드에 영향이 없다는 점이 있습니다.
- 단점으로는 케이블에 문제가 생겼을 때 모든 노드가 영향을 받고, 스푸핑의 위험에 노출되어 있습니다. 또한 노드에 문제가 생겼을때 어떤 노드가 문제가 있는지 찾아내기 어렵다는 점이 있습니다.
### 스푸핑이란?
스푸핑(spoofing)은 LAN상에서 송신부의 패킷을 송신과 관련 없는 다른 호스트에 가지 않도록 하는 스위칭 기능을 마비시키거나 속여서 특정 노드에 해당 패킷이 오도록 처리하는 것을 말합니다.   

3. 스타 토폴로지
- 스타 토폴로지(Star topology)는 중앙의 노드에 다른 모든 노드들이 연결된 네트워크 구성 형태입니다. 
- 장점으로는 노드의 추가와 에러의 탐지가 쉽고 패킷 충돌의 가능성이 적습니다. 또한 중앙 이외의 노드의 오류가 다른 노드에 영향을 끼치지 않는다는 점이 있습니다
- 단점으로는 중앙 노드에 장애가 발생하면 전체 네트워크를 사용할 수 없고 설치 비용이 고가입니다.
1. 링형 토폴로지
- 링형(Ring topology)는 각각의 노드가 양 옆의 두 노드와 연결하여 전체적으로 고리처럼 하나의 연속된 길을 통해 통신을 하는 망 구성방식입니다.
- 장점으로는 노드 수가 증가되어도 패킷 손실이 적고 총돌이 적으며 노드의 고장도 쉽게 색출이 가능하는 점입니다.
- 단점으로는 네트워크의 구성 변경이 어렵고 한 회선에 문제가 생기면 전체 네트워크에 영향이 간다는 점이 있습니다.
5. 메시 토폴로지
- 메시 토폴로지(Mesh topology)는 망형 토폴로지라고도 하며 그물망처럼 연결되어 있는 구조입니다.
- 장점으로는 한 노드에 고장이 발생해도 여러 경로가 존재하므로 네트워크를 계속 사용할 수 있고 트래픽의 분산 처리가 가능하다는 점 입니다.
- 단점으로는 노드의 추가가 어렵고 많은 링크를 필요로 하기 때문에 구축 비용과 운용 비용이 고가라는 점이 있습니다.
### 병목 현상
병목 현상이란
- 병목(Bottleneck) 현상은 전체 시스템의 성능이나 용량이 하나의 구성 요소로 인해 제한을 받는 현상을 뜻합니다.   

병목 현상과 네트워크 토폴로지의 관계
- 네트워크 토폴로지가 중요한 이유는 병목 현상을 찾을 때 중요한 기준이 되기 때문입니다. 한 노드에 트래픽이 집중되거나 해당 노드에 문제가 있어 지연 시간이 비정상적으로 긴 경우가 발생했을 때 토폴로지를 파악하지 못했다면 아무리 대역폭을 늘려도 문제를 해결 할 수 없을 것입니다. 
---
## 2.1.3 네트워크 분류
네트워크는 규모를 기준으로 분류 할 수 있습니다. 크기에 따라 내림차순으로 WAN, MAN, LAN으로 나뉠 수 있으며 각각 Wide Area Network, Metropolitan Area Network, Local Area Network의 약자입니다.

---
## 2.1.4 네트워크 성능 분석 명령어
네트워크 상태에 문제가 있어 애플리케이션상에서는 아무런 문제가 없음에도 불구하고 사용자가 서비스로부터 데이터를 가져오지 못하는 상황이 발생할 수도 있습니다. 이때, 네트워크 상태를 진단할 수 있는 명령어들이 있습니다.
1. ping
-ping(Packet Internet Groper)은 네트워크 상태를 확인하려는 대상 노드를 향해 특정 크기의 패킷을 전송하는 명령어입니다. 이 명령어를 통해 보내는 노드까지의 네트워크가 연결되어 있는지, 패킷을 주고 받는 시간은 얼마나 걸렸는지 등을 알 수 있습니다.
2. netstat
- netstat 명령어는 접속되어 있는 서비스들의 네트워크 상태를 표시하는 데 사용되며 네트워크 접속, 라우팅 테이블, 네트워크 프로토콜 등 리스트를 보여줍니다.
3. nslookup
- nslookup 명령어는 DNS에 관련된 내용을 확인하기 위해 쓰는 명령어입니다. 특정 도메인에 메핑된 IP를 확인하기 위해 사용합니다.
4. tracert
- 윈도우에서는 tracert, 리눅스에서는 traceroute라는 명령어로 구동됩니다. 이 명령어는 목적지 노드까지의 네트워크 경로를 확인할 때 사용하는 명령어입니다. 목적지 노드까지의 구간들 중 어느 구간에서 혼잡이 발생하는지 등을 알아낼 수 있습니다.

---
## 2.1.5 네트워크 프로토콜 표준화
네트워크 프로토콜이란 다른 장치들끼리 데이터를 주고받기 위해 설정된 공통된 인터페이스를 말합니다. 대표적인 네트워크 프로토콜로 http가 있습니다. http 프로토콜로 약속된 인터페이스를 통해 웹 서비스를 기반으로 데이터 송수신이 가능해지는것입니다.

# 2.2 TCP/IP 4계층 모델
인터넷 프로토콜 스위트(Internet protocol suite)는 인터넷 프로토콜들의 집합이며, 이를 OSI 7계층(OSI 7 layer) 또는 TCP/IP 4계층 모델로 설명합니다.

---
## 2.2.1 계층 구조
TCP/IP 4계층은 특정 계층이 다른 계층에 영향을 끼치지 않도록 설계되었습니다. 이로써 한 계층의 프로토콜이 변경되더라도 다른 계층까지 바꿀 필요가 없이 유연하게 설계된 것입니다.
### 애플리케이션 계층
애플리케이션 계층(Application layer)은 사용자가 실제로 사용하는 응용 프로그램이 사용하는 프로토콜 계층입니다.
### 전송 계층
전송 계층(Transport layer)은 송수신자를 서로 연결하는 프로토콜을 담당하는 계층입니다. 대표적으로 TCP와 UDP가 있습니다.
#### **TCP 프로토콜의 특징**
1. 연결 지향 서비스
- TCP는 연결 지향 프로토콜입니다. TCP에서는, 두 노드의 각 프로세스들이 서로 데이터를 주고받고자 하는 경우 먼저 두 TCP 간에 가상 연결이 설정되어야 합니다.
2. 신뢰성 서비스
- TCP는 신뢰성이 있는 전송 프로토콜입니다. TCP에서는 데이터가 안전하고 오류 없이 도착했는지 확인하는 확인응답 메커니즘을 이용함으로서 데이터의 신뢰성을 제공합니다.
3. 흐름 제어
- TCP는 UDP와 다르게 흐름 제어를 제공합니다. TCP에서는 송신자가 수신자의 상황에 맞춰 보내는 데이터의 양을 조절함으로서 수신자가 너무 과도한 데이터를 받아 손실이 일어나는 경우를 방지합니다.
4. 혼잡 제어
- TCP는 또한 네트워크 망 상태에 따라 전송하는 데이터의 양을 조절하는 혼잡 제어를 제공합니다. TCP는 보내는 패킷의 손실이 발생하거나 지연 시간이 길어지면 혼잡이 발생했다고 판단하고 이에 따라 보내는 데이터의 양을 조절합니다.
#### **UDP 프로토콜의 특징**
1. 비연결형 서비스
- TCP와 다르게 UDP는 비연결형 프로토콜입니다. UDP에서는 연결 수립 과정 절차가 따로 없고, 전송하는 각각의 패킷들이 서로 독립적입니다.
2. 비신뢰성 서비스
- UDP 프로토콜에서는 오류 제어를 제공하지 않아 데이터의 손실이나 훼손을 책임지지 않습니다
3. 혼잡제어의 미제공
- UDP에서는 망의 혼잡을 고려하지 않습니다.

#### **TCP와 UDP의 차이점과 이에 따른 장단점**
1. TCP는 연결 지향 프로토콜이므로 데이터 송수신 전 연결 성립 과정이 있습니다. 또한 오류 제어를 제공해 데이터 송수신 과정의 신뢰성을 보장해주지만, 많은 지연과 오버헤드를 발생시키기도 합니다. 따라서 TCP는 데이터의 무결성이 데이터의 응답속도보다 중요한 작업인 파일 다운로드나 메시지 채팅에 주로 쓰이는 프로토콜입니다.      
하지만 UDP의 경우 오류 제어 서비스가 없어 데이터의 신뢰성이 보장되지는 않지만 별도의 연결 수립 과정이 없어 응답 속도가 중요한 온라인 게임이나 데이터의 훼손이 큰 영향을 끼치지 않는 VoIP나 실시간 스트리밍에서 UDP가 자주 사용됩니다.   

2. UDP는 TCP와 다르게 혼잡제어를 하지 않는 프로토콜입니다. 하지만 이것이 UDP가 망 혼잡상태를 유발시킨다고 할 수 없는데, 그 이유는 UDP는 데이터가 훼손되거나 잃는다고 해서 같은 데이터를 재전송하지 않기 때문입니다. 따라서 UDP는 망 혼잡이 큰 문제일 경우에 TCP보다 더 유리하다고 할 수도 있습니다.
### TCP 연결 성립 과정
TCP는 연결의 신뢰성을 보장하는 작업으로 3-way handshake라는 작업을 진행합니다
1. SYN
- 가장 먼저 클라이언트가 서버로 특정한 정보가 담겨져 있는 패킷을 보냅니다. 이 패킷에는 ISN이라는 번호가 있는데, 보낼 때 임의로 정해져서 보내지고 이후 이 ISN을 이용해 클라이언트와 서버가 서로의 데이터를 주고 받았음을 확인합니다
2. SYN + ACK
- 클라이언트로부터 SYN을 받은 서버는 클라이언트에게 SYN을 보냄과 동시에 클라이언트가 받은 SYN을 받았다는 의미로 ACK을 같이 보내게 됩니다. 이 ACK에는 SYN의 ISN에 1을 더한 숫자가 ISN으로써 보내지게 됩니다.
3. ACK
- 서버의 SYN + ACK을 받은 클라이언트는 최종적으로 서버가 보낸 SYN에 대한 ACK을 보냄으로써 서버의 SYN을 정상적으로 받았음을 알립니다. 이 경우 역시 서버의 SYN에 있는 ISN에 1을 더한 숫자를 ACK안에 ISN으로 보냅니다.

### TCP 연결 해제 과정
TCP 프로토콜에서 연결을 해제하는 과정은 4-way handshake 과정입니다.
1. FIN
- 클라이언트가 서버에게 연결 종료를 요청하고자 할 때 FIN 패킷을 보내게 됩니다. 이후 클라이언트는 FIN-WAIT-1 상태에 들어가게 되는데, 이는 FIN 전송이후 이것에 대한 ACK이 오기 전 까지의 상태를 의미합니다
2. ACK
- 클라이언트로부터 FIN을 받은 서버는 이에 대한 응답으로 ACK을 보내게 됩니다. 중요한 점은 이후 바로 FIN을 보내지 않는다는 것인데, 아직 전송하지 못한 데이터가 남아있을 수 있기 때문입니다. 클라이언트에서는 이 ACK을 받으면 FIN-WAIT-2 상태에 들어가게 되고 이 단계에서 남은 데이터를 수신하게됩니다.
3. FIN
- 남은 데이터를 모두 보낸 서버는 클라이언트에게 FIN을 보내게 됩니다. 이 FIN을 받은 클라이언트는 이에 대한 ACK을 보내고 즉각 연결을 종료하지않고 일정시간 TIME-WAIT 상태가 됩니다.
4. ACK
- 클라이언트가 보낸 ACK을 받은 서버는 연결을 종료하게 됩니다.

**TIME-WAIT 상태가 필요한 이유**
1. ACK 패킷의 손실이 일어난 경우
- 서버의 FIN을 받은 클라이언트가 이에 대한 ACK을 보내고 그 즉시 연결을 종료하면, 클라이언트는 더 이상 서버로 어떠한 패킷도 보낼수 없게 됩니다. 만약에 이 ACK의 손실이 일어나 서버가 ACK을 받지 못했다면, 서버 입장에서는 클라이언트가 FIN을 받지 못했다고 판단해 계속해서 FIN을 보내게 되지만, 클라이언트는 이미 연결을 종료한 상태이므로 FIN을 받을 수도, ACK을 보낼 수도 없을 것입니다. 그렇다면 서버는 절대로 ACK을 받지 못할 것이고, 결론적으로 영원히 연결을 종료할 수 없게 됩니다. 이러한 문제를 방지하기 위해서는, 클라이언트가 바로 연결을 종료하지 않고 잠시 대기해야 할 것입니다.
2. 지연 패킷이 발생하는 경우
- 클라이언트가 TIME-WAIT 상태 없이 바로 연결을 종료하고 직후에 완전히 동일한 포트 번호와 IP 주소로 소켓이 생성되 새로운 연결이 수립된 경우, 이것은 마치 예전에 종료된 연결이 다시 살아난 것 처럼 보이게 됩니다. 이 새로운 연결에 이전에 수립된 연결에서 송수신하던 패킷이 이 연결에 수신된다면, 큰 혼란이 생길 것입니다. 이러한 문제를 해결하고자 TCP 프로토콜에서는 FIN이 수신되더라도 그 즉시 연결을 종료하지 않고, 일정 시간 그 연결의 소켓 주소를 점유하고자 TIME-WAIT 상태에 들어가게 되는 것입니다.

### 인터넷 계층
인터넷 계층(Internet layer)은 장치로부터 받은 네트워크 패킷을 지정된 목적지로 전송하기 위해 사용되는 계층입니다. IP, ARP, ICMP등의 프로토콜이 있으며 패킷을 수신해야 할 상대의 주소를 지정하여 데이터를 전달합니다.

### 링크 계층
링크 계층(Link layer)은 전선, 광섬유, 무선 등으로 실질적으로 데이터를 전달하며 장치 간에 신호를 주고 받는 프로토콜이 있는 계층입니다.

#### 유선 LAN
- 유선 LAN을 이루는 이더넷은 IEEE802.3이라는 프로토콜을 따릅니다. 이는 여러 제조업자들이 만들어내는 장치들 간에 상호 통신이 가능하게 하는 표준을 제정하기 위함이였으며 주요 LAN 프로토콜인 물리층과 데이터링크 층의 기능들을 규정하였고 전이중화 통신을 씁니다.
#### 전이중화 통신
- 전이중화(full duplex) 통신은 양쪽 장치가 동시에 송수신 할 수 있는 방식을 말합니다. 현대의 고속 이더넷은 이 방식을 기반으로 통신합니다.
#### 무선 LAN
- 무선 LAN 장치들은 송신과 수신에 같은 채널을 공유하기 때문에 반이중화 통신을 사용합니다.
#### 반이중화 통신
- 반이중화(half duplex) 통신은 송수신을 동시에 통신할 수 없으며 한 번에 한 방향만 통신할 수 있는 방식을 말합니다.

### 계층 간 데이터 송수신 과정
어떠한 데이터가 송수신될 때, 그 데이터는 송신장치의 각 계층을 따라 전달되고, 다시 수신 장치의 각 계층을 거슬러 올라가면서 전달됩니다. 각 계층에서 그 계층의 프로토콜에 따라 요청되는 값들이 헤더로 붙여지고 캡슐화(encapsulation)되어 다음 계층으로 전달되고, 수신 과정에서 다시 비캡슐화 과정을 거쳐 최종적으로 데이터의 전달이 완료됩니다.

#### 캡슐화 과정
- 애플리케이션에서 최초로 보내는 데이터에는 어떠한 헤더도 붙여지지 않아있는 상태입니다. 하지만 각 계층을 거치면서 그 계층의 프로토콜의 요청에 따라 값들이 헤더의 형태로 데이터에 붙여지고 다음 계층으로 전달될 것입니다. 여기서 그 다음 계층을 헤더가 붙어있는 데이터를 따로 분리해서 취급하지 않고 하나의 완전한 데이터로 취급하게 됩니다. 다시말해, 상위 계층에서 헤더는 하위 계층에서는 하나의 데이터로 다루어지게 된다는 뜻입니다. 이것을 캡슐화라고 합니다.
#### 비캡슐화 과정
- 비캡슐화 과정은 캡슐화 과정과 반대로 각 계층에서의 헤더를 분리해 헤더와 데이터 부분으로 나누어 상위 계층에 전달하는 과정을 의미합니다. 인터넷 계층에서 IP 헤더, 전송 계층에서 TCP 헤더가 분리되어 최종적으로 애플리케이션 계층에서 데이터만을 받게 되는 것입니다.

---
## 2.2.2 PDU
네트워크의 어떠한 계층에서 계층으로 데이터가 전달될 때, 그 데이터의 단위를 PDU(Protocol Data Unit)이라고 합니다. PDU는 각 계층의 프로토콜에서 담당하는 제어부분인 '헤더'와 데이터를 의미하는 '페이로드'로 구성되어 있으며 각 계층마다 PDU를 부르는 명칭이 다릅니다.

|Layer|PDU|
|------|---|
|Transport layer|Segment(TCP), Datagram(UDP)|
|Network layer|Packet|
|Data link layer|Frame|
|Physical layer|Bit|
*22년도 1학기 컴퓨터 네트워크 중간고사 출제내용*